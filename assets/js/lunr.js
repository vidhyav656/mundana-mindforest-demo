/*
 MIT
 lunr.tokenizer
 Copyright (C) 2017 Oliver Nightingale
*/
(function(){var b=function(a){var c=new b.Builder;c.pipeline.add(b.trimmer,b.stopWordFilter,b.stemmer);c.searchPipeline.add(b.stemmer);a.call(c,c);return c.build()};b.version="2.1.5";b.utils={};b.utils.warn=function(a){return function(b){a.console&&console.warn&&console.warn(b)}}(this);b.utils.asString=function(a){return void 0===a||null===a?"":a.toString()};b.FieldRef=function(a,b,d){this.docRef=a;this.fieldName=b;this._stringValue=d};b.FieldRef.joiner="/";b.FieldRef.fromString=function(a){var c=
a.indexOf(b.FieldRef.joiner);if(-1===c)throw"malformed field ref string";var d=a.slice(0,c);c=a.slice(c+1);return new b.FieldRef(c,d,a)};b.FieldRef.prototype.toString=function(){void 0==this._stringValue&&(this._stringValue=this.fieldName+b.FieldRef.joiner+this.docRef);return this._stringValue};b.idf=function(a,b){var c=0,f;for(f in a)"_index"!=f&&(c+=Object.keys(a[f]).length);return Math.log(1+Math.abs((b-c+.5)/(c+.5)))};b.Token=function(a,b){this.str=a||"";this.metadata=b||{}};b.Token.prototype.toString=
function(){return this.str};b.Token.prototype.update=function(a){this.str=a(this.str,this.metadata);return this};b.Token.prototype.clone=function(a){a=a||function(a){return a};return new b.Token(a(this.str,this.metadata),this.metadata)};b.tokenizer=function(a){if(null==a||void 0==a)return[];if(Array.isArray(a))return a.map(function(a){return new b.Token(b.utils.asString(a).toLowerCase())});a=a.toString().trim().toLowerCase();for(var c=a.length,d=[],f=0,e=0;f<=c;f++){var g=a.charAt(f),h=f-e;if(g.match(b.tokenizer.separator)||
f==c)0<h&&d.push(new b.Token(a.slice(e,f),{position:[e,h],index:d.length})),e=f+1}return d};b.tokenizer.separator=/[\s\-]+/;b.Pipeline=function(){this._stack=[]};b.Pipeline.registeredFunctions=Object.create(null);b.Pipeline.registerFunction=function(a,c){c in this.registeredFunctions&&b.utils.warn("Overwriting existing registered function: "+c);a.label=c;b.Pipeline.registeredFunctions[a.label]=a};b.Pipeline.warnIfFunctionNotRegistered=function(a){a.label&&a.label in this.registeredFunctions||b.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",
a)};b.Pipeline.load=function(a){var c=new b.Pipeline;a.forEach(function(a){var d=b.Pipeline.registeredFunctions[a];if(d)c.add(d);else throw Error("Cannot load unregistered function: "+a);});return c};b.Pipeline.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(a){b.Pipeline.warnIfFunctionNotRegistered(a);this._stack.push(a)},this)};b.Pipeline.prototype.after=function(a,c){b.Pipeline.warnIfFunctionNotRegistered(c);var d=this._stack.indexOf(a);if(-1==d)throw Error("Cannot find existingFn");
this._stack.splice(d+1,0,c)};b.Pipeline.prototype.before=function(a,c){b.Pipeline.warnIfFunctionNotRegistered(c);var d=this._stack.indexOf(a);if(-1==d)throw Error("Cannot find existingFn");this._stack.splice(d,0,c)};b.Pipeline.prototype.remove=function(a){a=this._stack.indexOf(a);-1!=a&&this._stack.splice(a,1)};b.Pipeline.prototype.run=function(a){for(var b=this._stack.length,d=0;d<b;d++){var f=this._stack[d];a=a.reduce(function(b,c,d){c=f(c,d,a);return void 0===c||""===c?b:b.concat(c)},[])}return a};
b.Pipeline.prototype.runString=function(a){a=new b.Token(a);return this.run([a]).map(function(a){return a.toString()})};b.Pipeline.prototype.reset=function(){this._stack=[]};b.Pipeline.prototype.toJSON=function(){return this._stack.map(function(a){b.Pipeline.warnIfFunctionNotRegistered(a);return a.label})};b.Vector=function(a){this._magnitude=0;this.elements=a||[]};b.Vector.prototype.positionForIndex=function(a){if(0==this.elements.length)return 0;for(var b=0,d=this.elements.length/2,f=d-b,e=Math.floor(f/
2),g=this.elements[2*e];1<f;){g<a&&(b=e);g>a&&(d=e);if(g==a)break;f=d-b;e=b+Math.floor(f/2);g=this.elements[2*e]}if(g==a||g>a)return 2*e;if(g<a)return 2*(e+1)};b.Vector.prototype.insert=function(a,b){this.upsert(a,b,function(){throw"duplicate index";})};b.Vector.prototype.upsert=function(a,b,d){this._magnitude=0;var c=this.positionForIndex(a);this.elements[c]==a?this.elements[c+1]=d(this.elements[c+1],b):this.elements.splice(c,0,a,b)};b.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;
for(var a=0,b=this.elements.length,d=1;d<b;d+=2){var f=this.elements[d];a+=f*f}return this._magnitude=Math.sqrt(a)};b.Vector.prototype.dot=function(a){var b=0,d=this.elements;a=a.elements;for(var f=d.length,e=a.length,g,h,k=0,l=0;k<f&&l<e;)g=d[k],h=a[l],g<h?k+=2:g>h?l+=2:g==h&&(b+=d[k+1]*a[l+1],k+=2,l+=2);return b};b.Vector.prototype.similarity=function(a){return this.dot(a)/(this.magnitude()*a.magnitude())};b.Vector.prototype.toArray=function(){for(var a=Array(this.elements.length/2),b=1,d=0;b<this.elements.length;b+=
2,d++)a[d]=this.elements[b];return a};b.Vector.prototype.toJSON=function(){return this.elements};b.stemmer=function(){var a={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},b={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},d=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,
f=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$/,g=/^([^aeiou][^aeiouy]*)?[aeiouy]/,h=/^(.+?)(ss|i)es$/,k=/^(.+?)([^s])s$/,l=/^(.+?)eed$/,p=/^(.+?)(ed|ing)$/,t=/.$/,w=/(at|bl|iz)$/,v=/([^aeiouylsz])\1$/,u=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,r=/^(.+?[^aeiou])y$/,A=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,
x=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,D=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,B=/^(.+?)(s|t)(ion)$/,y=/^(.+?)e$/,E=/ll$/,z=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,C=function(c){if(3>c.length)return c;var F=c.substr(0,1);"y"==F&&(c=F.toUpperCase()+c.substr(1));var n=h;var m=k;n.test(c)?c=c.replace(n,"$1$2"):m.test(c)&&(c=c.replace(m,"$1$2"));n=l;m=p;if(n.test(c))m=n.exec(c),n=d,n.test(m[1])&&(n=t,c=c.replace(n,""));else if(m.test(c)){m=
m.exec(c);var q=m[1];m=g;if(m.test(q)){c=q;m=w;var C=v;m.test(c)?c+="e":C.test(c)?(n=t,c=c.replace(n,"")):u.test(c)&&(c+="e")}}n=r;n.test(c)&&(m=n.exec(c),q=m[1],c=q+"i");n=A;n.test(c)&&(m=n.exec(c),q=m[1],m=m[2],n=d,n.test(q)&&(c=q+a[m]));n=x;n.test(c)&&(m=n.exec(c),q=m[1],m=m[2],n=d,n.test(q)&&(c=q+b[m]));n=D;m=B;n.test(c)?(m=n.exec(c),q=m[1],n=f,n.test(q)&&(c=q)):m.test(c)&&(m=m.exec(c),q=m[1]+m[2],m=f,m.test(q)&&(c=q));n=y;n.test(c)&&(m=n.exec(c),q=m[1],n=f,m=e,C=z,n.test(q)||m.test(q)&&!C.test(q))&&
(c=q);n=E;m=f;n.test(c)&&m.test(c)&&(n=t,c=c.replace(n,""));"y"==F&&(c=F.toLowerCase()+c.substr(1));return c};return function(a){return a.update(C)}}();b.Pipeline.registerFunction(b.stemmer,"stemmer");b.generateStopWordFilter=function(a){var b=a.reduce(function(a,b){a[b]=b;return a},{});return function(a){if(a&&b[a.toString()]!==a.toString())return a}};b.stopWordFilter=b.generateStopWordFilter("a able about across after all almost also am among an and any are as at be because been but by can cannot could dear did do does either else ever every for from get got had has have he her hers him his how however i if in into is it its just least let like likely may me might most must my neither no nor not of off often on only or other our own rather said say says she should since so some than that the their them then there these they this tis to too twas us wants was we were what when where which while who whom why will with would yet you your".split(" "));
b.Pipeline.registerFunction(b.stopWordFilter,"stopWordFilter");b.trimmer=function(a){return a.update(function(a){return a.replace(/^\W+/,"").replace(/\W+$/,"")})};b.Pipeline.registerFunction(b.trimmer,"trimmer");b.TokenSet=function(){this["final"]=!1;this.edges={};this.id=b.TokenSet._nextId;b.TokenSet._nextId+=1};b.TokenSet._nextId=1;b.TokenSet.fromArray=function(a){for(var c=new b.TokenSet.Builder,d=0,f=a.length;d<f;d++)c.insert(a[d]);c.finish();return c.root};b.TokenSet.fromClause=function(a){return"editDistance"in
a?b.TokenSet.fromFuzzyString(a.term,a.editDistance):b.TokenSet.fromString(a.term)};b.TokenSet.fromFuzzyString=function(a,c){for(var d=new b.TokenSet,f=[{node:d,editsRemaining:c,str:a}];f.length;){var e=f.pop();if(0<e.str.length){var g=e.str.charAt(0);if(g in e.node.edges)var h=e.node.edges[g];else h=new b.TokenSet,e.node.edges[g]=h;1==e.str.length?h["final"]=!0:f.push({node:h,editsRemaining:e.editsRemaining,str:e.str.slice(1)})}0<e.editsRemaining&&1<e.str.length&&(g=e.str.charAt(1),g in e.node.edges?
h=e.node.edges[g]:(h=new b.TokenSet,e.node.edges[g]=h),2>=e.str.length?h["final"]=!0:f.push({node:h,editsRemaining:e.editsRemaining-1,str:e.str.slice(2)}));0<e.editsRemaining&&1==e.str.length&&(e.node["final"]=!0);0<e.editsRemaining&&1<=e.str.length&&("*"in e.node.edges?g=e.node.edges["*"]:(g=new b.TokenSet,e.node.edges["*"]=g),1==e.str.length?g["final"]=!0:f.push({node:g,editsRemaining:e.editsRemaining-1,str:e.str.slice(1)}));0<e.editsRemaining&&("*"in e.node.edges?g=e.node.edges["*"]:(g=new b.TokenSet,
e.node.edges["*"]=g),0==e.str.length?g["final"]=!0:f.push({node:g,editsRemaining:e.editsRemaining-1,str:e.str}));if(0<e.editsRemaining&&1<e.str.length){g=e.str.charAt(0);h=e.str.charAt(1);if(h in e.node.edges)var k=e.node.edges[h];else k=new b.TokenSet,e.node.edges[h]=k;1==e.str.length?k["final"]=!0:f.push({node:k,editsRemaining:e.editsRemaining-1,str:g+e.str.slice(2)})}}return d};b.TokenSet.fromString=function(a){for(var c=new b.TokenSet,d=c,f=!1,e=0,g=a.length;e<g;e++){var h=a[e],k=e==g-1;if("*"==
h)f=!0,c.edges[h]=c,c["final"]=k;else{var l=new b.TokenSet;l["final"]=k;c=c.edges[h]=l;f&&(c.edges["*"]=d)}}return d};b.TokenSet.prototype.toArray=function(){for(var a=[],b=[{prefix:"",node:this}];b.length;){var d=b.pop(),f=Object.keys(d.node.edges),e=f.length;d.node["final"]&&a.push(d.prefix);for(var g=0;g<e;g++){var h=f[g];b.push({prefix:d.prefix.concat(h),node:d.node.edges[h]})}}return a};b.TokenSet.prototype.toString=function(){if(this._str)return this._str;for(var a=this["final"]?"1":"0",b=Object.keys(this.edges).sort(),
d=b.length,f=0;f<d;f++){var e=b[f];a=a+e+this.edges[e].id}return a};b.TokenSet.prototype.intersect=function(a){for(var c=new b.TokenSet,d=[{qNode:a,output:c,node:this}];d.length;){a=d.pop();for(var f=Object.keys(a.qNode.edges),e=f.length,g=Object.keys(a.node.edges),h=g.length,k=0;k<e;k++)for(var l=f[k],p=0;p<h;p++){var t=g[p];if(t==l||"*"==l){var w=a.node.edges[t],v=a.qNode.edges[l],u=w["final"]&&v["final"];if(t in a.output.edges){var r=a.output.edges[t];r["final"]=r["final"]||u}else r=new b.TokenSet,
r["final"]=u,a.output.edges[t]=r;d.push({qNode:v,output:r,node:w})}}}return c};b.TokenSet.Builder=function(){this.previousWord="";this.root=new b.TokenSet;this.uncheckedNodes=[];this.minimizedNodes={}};b.TokenSet.Builder.prototype.insert=function(a){var c=0;if(a<this.previousWord)throw Error("Out of order word insertion");for(var d=0;d<a.length&&d<this.previousWord.length&&a[d]==this.previousWord[d];d++)c++;this.minimize(c);var f=0==this.uncheckedNodes.length?this.root:this.uncheckedNodes[this.uncheckedNodes.length-
1].child;for(d=c;d<a.length;d++){c=new b.TokenSet;var e=a[d];f.edges[e]=c;this.uncheckedNodes.push({parent:f,"char":e,child:c});f=c}f["final"]=!0;this.previousWord=a};b.TokenSet.Builder.prototype.finish=function(){this.minimize(0)};b.TokenSet.Builder.prototype.minimize=function(a){for(var b=this.uncheckedNodes.length-1;b>=a;b--){var d=this.uncheckedNodes[b],f=d.child.toString();f in this.minimizedNodes?d.parent.edges[d["char"]]=this.minimizedNodes[f]:(d.child._str=f,this.minimizedNodes[f]=d.child);
this.uncheckedNodes.pop()}};b.Index=function(a){this.invertedIndex=a.invertedIndex;this.fieldVectors=a.fieldVectors;this.tokenSet=a.tokenSet;this.fields=a.fields;this.pipeline=a.pipeline};b.Index.prototype.search=function(a){return this.query(function(c){(new b.QueryParser(a,c)).parse()})};b.Index.prototype.query=function(a){var c=new b.Query(this.fields),d=Object.create(null),f=Object.create(null),e=Object.create(null);a.call(c,c);for(a=0;a<c.clauses.length;a++){var g=c.clauses[a],h=null;h=g.usePipeline?
this.pipeline.runString(g.term):[g.term];for(var k=0;k<h.length;k++){g.term=h[k];var l=b.TokenSet.fromClause(g);l=this.tokenSet.intersect(l).toArray();for(var p=0;p<l.length;p++)for(var t=l[p],w=this.invertedIndex[t],v=w._index,u=0;u<g.fields.length;u++){var r=g.fields[u],A=w[r],x=Object.keys(A),D=t+"/"+r;void 0===f[r]&&(f[r]=new b.Vector);f[r].upsert(v,1*g.boost,function(a,b){return a+b});if(!e[D]){for(var B=0;B<x.length;B++){var y=x[B],E=new b.FieldRef(y,r);y=A[y];var z;void 0===(z=d[E])?d[E]=new b.MatchData(t,
r,y):z.add(t,r,y)}e[D]=!0}}}}c=Object.keys(d);e=[];z=Object.create(null);for(a=0;a<c.length;a++)h=b.FieldRef.fromString(c[a]),g=h.docRef,k=f[h.fieldName].similarity(this.fieldVectors[h]),void 0!==(l=z[g])?(l.score+=k,l.matchData.combine(d[h])):(h={ref:g,score:k,matchData:d[h]},z[g]=h,e.push(h));return e.sort(function(a,b){return b.score-a.score})};b.Index.prototype.toJSON=function(){var a=Object.keys(this.invertedIndex).sort().map(function(a){return[a,this.invertedIndex[a]]},this),c=Object.keys(this.fieldVectors).map(function(a){return[a,
this.fieldVectors[a].toJSON()]},this);return{version:b.version,fields:this.fields,fieldVectors:c,invertedIndex:a,pipeline:this.pipeline.toJSON()}};b.Index.load=function(a){var c={},d={},f=a.fieldVectors,e={},g=a.invertedIndex,h=new b.TokenSet.Builder,k=b.Pipeline.load(a.pipeline);a.version!=b.version&&b.utils.warn("Version mismatch when loading serialised index. Current version of lunr '"+b.version+"' does not match serialized index '"+a.version+"'");for(var l=0;l<f.length;l++){var p=f[l];d[p[0]]=
new b.Vector(p[1])}for(l=0;l<g.length;l++)p=g[l],f=p[0],p=p[1],h.insert(f),e[f]=p;h.finish();c.fields=a.fields;c.fieldVectors=d;c.invertedIndex=e;c.tokenSet=h.root;c.pipeline=k;return new b.Index(c)};b.Builder=function(){this._ref="id";this._fields=[];this.invertedIndex=Object.create(null);this.fieldTermFrequencies={};this.fieldLengths={};this.tokenizer=b.tokenizer;this.pipeline=new b.Pipeline;this.searchPipeline=new b.Pipeline;this.documentCount=0;this._b=.75;this._k1=1.2;this.termIndex=0;this.metadataWhitelist=
[]};b.Builder.prototype.ref=function(a){this._ref=a};b.Builder.prototype.field=function(a){this._fields.push(a)};b.Builder.prototype.b=function(a){this._b=0>a?0:1<a?1:a};b.Builder.prototype.k1=function(a){this._k1=a};b.Builder.prototype.add=function(a){var c=a[this._ref];this.documentCount+=1;for(var d=0;d<this._fields.length;d++){var f=this._fields[d],e=this.tokenizer(a[f]);e=this.pipeline.run(e);var g=new b.FieldRef(c,f),h=Object.create(null);this.fieldTermFrequencies[g]=h;this.fieldLengths[g]=
0;this.fieldLengths[g]+=e.length;for(g=0;g<e.length;g++){var k=e[g];void 0==h[k]&&(h[k]=0);h[k]+=1;if(void 0==this.invertedIndex[k]){var l=Object.create(null);l._index=this.termIndex;this.termIndex+=1;for(var p=0;p<this._fields.length;p++)l[this._fields[p]]=Object.create(null);this.invertedIndex[k]=l}void 0==this.invertedIndex[k][f][c]&&(this.invertedIndex[k][f][c]=Object.create(null));for(l=0;l<this.metadataWhitelist.length;l++){p=this.metadataWhitelist[l];var t=k.metadata[p];void 0==this.invertedIndex[k][f][c][p]&&
(this.invertedIndex[k][f][c][p]=[]);this.invertedIndex[k][f][c][p].push(t)}}}};b.Builder.prototype.calculateAverageFieldLengths=function(){for(var a=Object.keys(this.fieldLengths),c=a.length,d={},f={},e=0;e<c;e++){var g=b.FieldRef.fromString(a[e]),h=g.fieldName;f[h]||(f[h]=0);f[h]+=1;d[h]||(d[h]=0);d[h]+=this.fieldLengths[g]}for(e=0;e<this._fields.length;e++)h=this._fields[e],d[h]/=f[h];this.averageFieldLength=d};b.Builder.prototype.createFieldVectors=function(){for(var a={},c=Object.keys(this.fieldTermFrequencies),
d=c.length,f=Object.create(null),e=0;e<d;e++){for(var g=b.FieldRef.fromString(c[e]),h=g.fieldName,k=this.fieldLengths[g],l=new b.Vector,p=this.fieldTermFrequencies[g],t=Object.keys(p),w=t.length,v=0;v<w;v++){var u=t[v],r=p[u],A=this.invertedIndex[u]._index;if(void 0===f[u]){var x=b.idf(this.invertedIndex[u],this.documentCount);f[u]=x}else x=f[u];l.insert(A,Math.round(x*(this._k1+1)*r/(this._k1*(1-this._b+k/this.averageFieldLength[h]*this._b)+r)*1E3)/1E3)}a[g]=l}this.fieldVectors=a};b.Builder.prototype.createTokenSet=
function(){this.tokenSet=b.TokenSet.fromArray(Object.keys(this.invertedIndex).sort())};b.Builder.prototype.build=function(){this.calculateAverageFieldLengths();this.createFieldVectors();this.createTokenSet();return new b.Index({invertedIndex:this.invertedIndex,fieldVectors:this.fieldVectors,tokenSet:this.tokenSet,fields:this._fields,pipeline:this.searchPipeline})};b.Builder.prototype.use=function(a){var b=Array.prototype.slice.call(arguments,1);b.unshift(this);a.apply(this,b)};b.MatchData=function(a,
b,d){for(var c=Object.create(null),e=Object.keys(d),g=0;g<e.length;g++){var h=e[g];c[h]=d[h].slice()}this.metadata=Object.create(null);this.metadata[a]=Object.create(null);this.metadata[a][b]=c};b.MatchData.prototype.combine=function(a){for(var b=Object.keys(a.metadata),d=0;d<b.length;d++){var f=b[d],e=Object.keys(a.metadata[f]);void 0==this.metadata[f]&&(this.metadata[f]=Object.create(null));for(var g=0;g<e.length;g++){var h=e[g],k=Object.keys(a.metadata[f][h]);void 0==this.metadata[f][h]&&(this.metadata[f][h]=
Object.create(null));for(var l=0;l<k.length;l++){var p=k[l];this.metadata[f][h][p]=void 0==this.metadata[f][h][p]?a.metadata[f][h][p]:this.metadata[f][h][p].concat(a.metadata[f][h][p])}}}};b.MatchData.prototype.add=function(a,b,d){if(a in this.metadata)if(b in this.metadata[a])for(var c=Object.keys(d),e=0;e<c.length;e++){var g=c[e];this.metadata[a][b][g]=g in this.metadata[a][b]?this.metadata[a][b][g].concat(d[g]):d[g]}else this.metadata[a][b]=d;else this.metadata[a]=Object.create(null),this.metadata[a][b]=
d};b.Query=function(a){this.clauses=[];this.allFields=a};b.Query.wildcard=new String("*");b.Query.wildcard.NONE=0;b.Query.wildcard.LEADING=1;b.Query.wildcard.TRAILING=2;b.Query.prototype.clause=function(a){"fields"in a||(a.fields=this.allFields);"boost"in a||(a.boost=1);"usePipeline"in a||(a.usePipeline=!0);"wildcard"in a||(a.wildcard=b.Query.wildcard.NONE);a.wildcard&b.Query.wildcard.LEADING&&a.term.charAt(0)!=b.Query.wildcard&&(a.term="*"+a.term);a.wildcard&b.Query.wildcard.TRAILING&&a.term.slice(-1)!=
b.Query.wildcard&&(a.term=""+a.term+"*");this.clauses.push(a);return this};b.Query.prototype.term=function(a,b){var c=b||{};c.term=a;this.clause(c);return this};b.QueryParseError=function(a,b,d){this.name="QueryParseError";this.message=a;this.start=b;this.end=d};b.QueryParseError.prototype=Error();b.QueryLexer=function(a){this.lexemes=[];this.str=a;this.length=a.length;this.start=this.pos=0;this.escapeCharPositions=[]};b.QueryLexer.prototype.run=function(){for(var a=b.QueryLexer.lexText;a;)a=a(this)};
b.QueryLexer.prototype.sliceString=function(){for(var a=[],b=this.start,d,f=0;f<this.escapeCharPositions.length;f++)d=this.escapeCharPositions[f],a.push(this.str.slice(b,d)),b=d+1;a.push(this.str.slice(b,this.pos));this.escapeCharPositions.length=0;return a.join("")};b.QueryLexer.prototype.emit=function(a){this.lexemes.push({type:a,str:this.sliceString(),start:this.start,end:this.pos});this.start=this.pos};b.QueryLexer.prototype.escapeCharacter=function(){this.escapeCharPositions.push(this.pos-1);
this.pos+=1};b.QueryLexer.prototype.next=function(){if(this.pos>=this.length)return b.QueryLexer.EOS;var a=this.str.charAt(this.pos);this.pos+=1;return a};b.QueryLexer.prototype.width=function(){return this.pos-this.start};b.QueryLexer.prototype.ignore=function(){this.start==this.pos&&(this.pos+=1);this.start=this.pos};b.QueryLexer.prototype.backup=function(){--this.pos};b.QueryLexer.prototype.acceptDigitRun=function(){do{var a=this.next();var c=a.charCodeAt(0)}while(47<c&&58>c);a!=b.QueryLexer.EOS&&
this.backup()};b.QueryLexer.prototype.more=function(){return this.pos<this.length};b.QueryLexer.EOS="EOS";b.QueryLexer.FIELD="FIELD";b.QueryLexer.TERM="TERM";b.QueryLexer.EDIT_DISTANCE="EDIT_DISTANCE";b.QueryLexer.BOOST="BOOST";b.QueryLexer.lexField=function(a){a.backup();a.emit(b.QueryLexer.FIELD);a.ignore();return b.QueryLexer.lexText};b.QueryLexer.lexTerm=function(a){1<a.width()&&(a.backup(),a.emit(b.QueryLexer.TERM));a.ignore();if(a.more())return b.QueryLexer.lexText};b.QueryLexer.lexEditDistance=
function(a){a.ignore();a.acceptDigitRun();a.emit(b.QueryLexer.EDIT_DISTANCE);return b.QueryLexer.lexText};b.QueryLexer.lexBoost=function(a){a.ignore();a.acceptDigitRun();a.emit(b.QueryLexer.BOOST);return b.QueryLexer.lexText};b.QueryLexer.lexEOS=function(a){0<a.width()&&a.emit(b.QueryLexer.TERM)};b.QueryLexer.termSeparator=b.tokenizer.separator;b.QueryLexer.lexText=function(a){for(;;){var c=a.next();if(c==b.QueryLexer.EOS)return b.QueryLexer.lexEOS;if(92==c.charCodeAt(0))a.escapeCharacter();else{if(":"==
c)return b.QueryLexer.lexField;if("~"==c)return a.backup(),0<a.width()&&a.emit(b.QueryLexer.TERM),b.QueryLexer.lexEditDistance;if("^"==c)return a.backup(),0<a.width()&&a.emit(b.QueryLexer.TERM),b.QueryLexer.lexBoost;if(c.match(b.QueryLexer.termSeparator))return b.QueryLexer.lexTerm}}};b.QueryParser=function(a,c){this.lexer=new b.QueryLexer(a);this.query=c;this.currentClause={};this.lexemeIdx=0};b.QueryParser.prototype.parse=function(){this.lexer.run();this.lexemes=this.lexer.lexemes;for(var a=b.QueryParser.parseFieldOrTerm;a;)a=
a(this);return this.query};b.QueryParser.prototype.peekLexeme=function(){return this.lexemes[this.lexemeIdx]};b.QueryParser.prototype.consumeLexeme=function(){var a=this.peekLexeme();this.lexemeIdx+=1;return a};b.QueryParser.prototype.nextClause=function(){this.query.clause(this.currentClause);this.currentClause={}};b.QueryParser.parseFieldOrTerm=function(a){a=a.peekLexeme();if(void 0!=a)switch(a.type){case b.QueryLexer.FIELD:return b.QueryParser.parseField;case b.QueryLexer.TERM:return b.QueryParser.parseTerm;
default:var c="expected either a field or a term, found "+a.type;1<=a.str.length&&(c+=" with value '"+a.str+"'");throw new b.QueryParseError(c,a.start,a.end);}};b.QueryParser.parseField=function(a){var c=a.consumeLexeme();if(void 0!=c){if(-1==a.query.allFields.indexOf(c.str))throw a=a.query.allFields.map(function(a){return"'"+a+"'"}).join(", "),a="unrecognised field '"+c.str+"', possible fields: "+a,new b.QueryParseError(a,c.start,c.end);a.currentClause.fields=[c.str];var d=a.peekLexeme();if(void 0==
d)throw new b.QueryParseError("expecting term, found nothing",c.start,c.end);switch(d.type){case b.QueryLexer.TERM:return b.QueryParser.parseTerm;default:throw a="expecting term, found '"+d.type+"'",new b.QueryParseError(a,d.start,d.end);}}};b.QueryParser.parseTerm=function(a){var c=a.consumeLexeme();if(void 0!=c)if(a.currentClause.term=c.str.toLowerCase(),-1!=c.str.indexOf("*")&&(a.currentClause.usePipeline=!1),c=a.peekLexeme(),void 0==c)a.nextClause();else switch(c.type){case b.QueryLexer.TERM:return a.nextClause(),
b.QueryParser.parseTerm;case b.QueryLexer.FIELD:return a.nextClause(),b.QueryParser.parseField;case b.QueryLexer.EDIT_DISTANCE:return b.QueryParser.parseEditDistance;case b.QueryLexer.BOOST:return b.QueryParser.parseBoost;default:throw new b.QueryParseError("Unexpected lexeme type '"+c.type+"'",c.start,c.end);}};b.QueryParser.parseEditDistance=function(a){var c=a.consumeLexeme();if(void 0!=c){var d=parseInt(c.str,10);if(isNaN(d))throw new b.QueryParseError("edit distance must be numeric",c.start,
c.end);a.currentClause.editDistance=d;c=a.peekLexeme();if(void 0==c)a.nextClause();else switch(c.type){case b.QueryLexer.TERM:return a.nextClause(),b.QueryParser.parseTerm;case b.QueryLexer.FIELD:return a.nextClause(),b.QueryParser.parseField;case b.QueryLexer.EDIT_DISTANCE:return b.QueryParser.parseEditDistance;case b.QueryLexer.BOOST:return b.QueryParser.parseBoost;default:throw a="Unexpected lexeme type '"+c.type+"'",new b.QueryParseError(a,c.start,c.end);}}};b.QueryParser.parseBoost=function(a){var c=
a.consumeLexeme();if(void 0!=c){var d=parseInt(c.str,10);if(isNaN(d))throw new b.QueryParseError("boost must be numeric",c.start,c.end);a.currentClause.boost=d;c=a.peekLexeme();if(void 0==c)a.nextClause();else switch(c.type){case b.QueryLexer.TERM:return a.nextClause(),b.QueryParser.parseTerm;case b.QueryLexer.FIELD:return a.nextClause(),b.QueryParser.parseField;case b.QueryLexer.EDIT_DISTANCE:return b.QueryParser.parseEditDistance;case b.QueryLexer.BOOST:return b.QueryParser.parseBoost;default:throw a=
"Unexpected lexeme type '"+c.type+"'",new b.QueryParseError(a,c.start,c.end);}}};(function(a,b){"function"===typeof define&&define.amd?define(b):"object"===typeof exports?module.exports=b():a.lunr=b()})(this,function(){return b})})();